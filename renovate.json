{
    "extends": [
      "local>platform-one/big-bang/pipeline-templates/renovate-runner"
    ],
    "baseBranches": [
        "main"
    ],
    "configWarningReuseIssue": false,
    "dependencyDashboard": true,
    "dependencyDashboardTitle": "Renovate: Upgrade Istiod Package Dependencies",
    "draftPR": true,
    "enabledManagers": [
        "custom.regex",
        "helmv3"
    ],
    "ignorePaths": [
        "chart/charts/**"
    ],
    "labels": [
        "istiod",
        "Big Bang Core",
        "Package Sustainment",
        "kind::maintenance",
        "renovate"
    ],
    "packageRules": [
      {
        "matchDatasources": ["docker", "helm"],
        "matchManagers": ["custom.regex", "helmv3"],
        "groupName": "Istiod"
      }
    ],
    "customManagers": [
        {
          "customType": "regex",
          "description": "Update tag in values to match upstream",
          "managerFilePatterns": [
            "/^chart/values.yaml$/"
          ],
          "matchStrings": [
            "tag:\\s+(?<currentValue>.+)"
          ],
          "autoReplaceStringTemplate": "tag: {{newValue}}",
          "depNameTemplate": "istiod",
          "datasourceTemplate": "helm",
          "registryUrlTemplate": "https://istio-release.storage.googleapis.com/charts"
        },
        {
            "customType": "regex",
            "managerFilePatterns": [
                "/^chart/Chart\\.yaml$/"
            ],
            "matchStrings": [
                "- Istio:\\s*(?<currentValue>.+)",
                "appVersion:[^\\S\\r\\n]+(?<currentValue>.+)"
            ],
            "depNameTemplate": "istiod",
            "datasourceTemplate": "helm",
            "registryUrlTemplate": "https://istio-release.storage.googleapis.com/charts"
        },
        {
            "customType": "regex",
            "managerFilePatterns": [
                "/^chart/Chart\\.yaml$/"
            ],
            "matchStrings": [
                "image:[^\\S\\r\\n]+(?<depName>.+):(?<currentValue>.+)"
            ],
            "datasourceTemplate": "docker"
        }
    ],
    "separateMajorMinor": false,
    "postUpdateOptions": [
        "helmUpdateSubChartArchives"
    ],
  "postUpgradeTasks": {
    "commands": [
      "bump-chart-yaml",
      "bump-changelog '{{#each upgrades}}- {{depName}} {{currentVersion}} -> {{newVersion}}\\n{{/each}}'",
      "regenerate-helm-docs"
    ],
    "fileFilters": [
      "chart/Chart.yaml",
      "README.md",
      "CHANGELOG.md"
    ]
  }
}
